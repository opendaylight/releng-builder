---
- builder:
    name: 'builder-opflex-libuv'
    builders:
      - shell: !include-raw-escape: deps-inc/libuv_tgz-build.sh

- builder:
    name: 'builder-opflex-openvswitch'
    builders:
      - shell: !include-raw: deps-inc/openvswitch_tgz-build.sh

- builder:
    name: 'builder-opflex-rapidjson'
    builders:
      - shell: !include-raw-escape: deps-inc/rapidjson_tgz-build.sh

- builder:
    name: opflex-build
    builders:
      - maven-target:
          maven-version: 'mvn33'
          pom: genie/pom.xml
          goals: compile
      - shell: !include-raw-escape: opflex-build.sh

- builder:
    name: opflex-build-deps
    builders:
      - inject:
          properties-content: |
              LIBUV_BUILD={libuv-build}
              LIBUV_SCM={libuv-scm}
              RAPIDJSON_BUILD={rapidjson-build}
              RAPIDJSON_SCM={rapidjson-scm}
              OPENVSWITCH_BUILD={openvswitch-build}
              OPENVSWITCH_SCM={openvswitch-scm}
      - builder-opflex-libuv
      - builder-opflex-rapidjson
      - builder-opflex-openvswitch

- builder:
    name: opflex-deploy-maven-file
    # Todo: Remove this builder when the generic version of the builder is
    # available in global-jjb. Change no: 5753
    # Deploy artifacts to a repository.
    #
    # The builder requires passing the following parameters
    # REPO_ID:           Repository ID
    # GROUP_ID:          Group ID of the repository
    # UPLOAD_FILES_PATH: Path to directory containing one or more files
    builders:
      - lf-maven-install:
          mvn-version: '{mvn-version}'
      - lf-provide-maven-settings:
          global-settings-file: '{global-settings-file}'
          settings-file: '{settings-file}'
      - inject:
          properties-content: |
              MAVEN_REPO_URL=file://$WORKSPACE/m2repo
              REPO_ID={repo-id}
              GROUP_ID={group-id}
              UPLOAD_FILES_PATH={upload-files-dir}
      - shell: !include-raw-escape:
          - ../global-jjb/shell/lftools-install.sh
          - ../global-jjb/shell/common-variables.sh
          - deploy-opflex.sh

- builder:
    name: opflex-maven-stage
    # Todo: Migrate to the generic version of the builders available in
    # global-jjb. Change no: 5753
    # Stage files to Nexus repository.
    #
    # The builder requires passing the following parameters
    # REPO_ID             : Repository ID
    # GROUP_ID            : Group ID of the repository
    # UPLOAD_FILES_PATH   : Path to directory containing one or more files
    # STAGING_PROFILE_ID  : Staging profile id created on Nexus
    builders:
      - lf-provide-maven-settings:
          global-settings-file: '{global-settings-file}'
          settings-file: '{settings-file}'
      - lf-infra-create-netrc:
          server-id: opendaylight-staging
      - inject:
          properties-content: |
              STAGING_PROFILE_ID={staging-profile-id}
      - shell: !include-raw-escape:
          - ../global-jjb/shell/lftools-install.sh
          - ../global-jjb/shell/maven-stage.sh
