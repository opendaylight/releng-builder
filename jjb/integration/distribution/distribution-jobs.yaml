---
- project:
    name: distribution
    jobs:
      # gerrit- is generic template, distribution- is project specific.
      - 'distribution-sanity-{stream}'
      - gerrit-maven-clm
      - gerrit-maven-verify-dependencies
      - gerrit-tox-verify
      - '{project-name}-rtd-jobs':
          project-pattern: integration/distribution
          rtd-build-url: https://readthedocs.org/api/v2/webhook/opendaylight-distribution/34591/
          rtd-token: 6247e7a21158a20b207470b8bf7719c676ff8944

    project: integration/distribution
    project-name: distribution
    mvn-settings: integration-distribution-settings
    mvn-goals: 'clean install dependency:tree -DoutputFile=dependency_tree.txt'
    mvn-opts: '-Xmx1024m'
    nexus-iq-namespace: odl-
    nexus-iq-stage: release
    email-upstream: '[int/dist]'
    stream:
      - aluminium:
          branch: 'master'
          jre: 'openjdk11'
          karaf-version: odl
      - magnesium:
          branch: 'stable/magnesium'
          jre: 'openjdk11'
          karaf-version: odl
          # Self-Managed projects repos and features:
          sm-repos: >
              mvn:org.opendaylight.detnet/features-detnet//xml/features
          sm-features: >
              odl-detnet-topology,
              odl-detnet-pce,
              odl-e2e-service,
              odl-detnet-models,
              odl-detnet-bandwidth,
              odl-detnet-gate,
              odl-detnet-qos,
              odl-detnet-clock,
              odl-detnet-tsn,
              odl-detnet-service,
              odl-detnet-driver,
              odl-detnet-all
      - sodium:
          branch: 'stable/sodium'
          karaf-version: odl
          # Self-Managed projects repos and features:
          sm-repos: >
              mvn:org.opendaylight.transportpce/features-transportpce//xml/features
          sm-features: >
              odl-transportpce,
              odl-transportpce-api,
              odl-transportpce-ordmodels
      - neon:
          branch: 'stable/neon'
          karaf-version: odl
          # Self-Managed projects repos and features:
          sm-repos: >
              mvn:org.opendaylight.transportpce/features-transportpce//xml/features
          sm-features: >
              odl-transportpce,
              odl-transportpce-api,
              odl-transportpce-ordmodels

- project:
    name: distribution-managed
    jobs:
      # gerrit- is generic template, distribution- is project specific.
      - 'distribution-merge-{type}-{stream}'
      - 'distribution-verify-{type}-{stream}'
      - 'distribution-check-{type}-{stream}'
      - 'distribution-csit-managed-{stream}'

    project: integration/distribution
    project-name: distribution
    mvn-settings: integration-distribution-settings
    mvn-goals: 'clean install dependency:tree -DoutputFile=dependency_tree.txt'
    mvn-opts: '-Xmx1024m'
    email-upstream: '[int/dist]'
    type: managed
    profile: '-Pmanaged'
    forbidden-files: 'opendaylight/**'
    karaf-version: karaf4
    dist-pom: 'distribution/pom.xml'

    stream:
      - aluminium:
          branch: 'master'
          java-version: 'openjdk11'
          jre: 'openjdk11'
          dependencies: >
              aaa-maven-merge-{stream},
              bgpcep-maven-merge-{stream},
              controller-maven-merge-{stream},
              daexim-maven-merge-{stream},
              genius-maven-merge-{stream},
              infrautils-maven-merge-{stream},
              jsonrpc-maven-merge-{stream},
              lispflowmapping-maven-merge-{stream},
              netconf-maven-merge-{stream},
              netvirt-maven-merge-{stream}
              neutron-maven-merge-{stream},
              openflowplugin-maven-merge-{stream},
              ovsdb-maven-merge-{stream},
              serviceutils-maven-merge-{stream},
      - magnesium:
          branch: 'stable/magnesium'
          java-version: 'openjdk11'
          jre: 'openjdk11'
          dependencies: >
              aaa-maven-merge-{stream},
              bgpcep-maven-merge-{stream},
              controller-maven-merge-{stream},
              daexim-maven-merge-{stream},
              genius-maven-merge-{stream},
              infrautils-maven-merge-{stream},
              jsonrpc-maven-merge-{stream},
              lispflowmapping-maven-merge-{stream},
              netconf-maven-merge-{stream},
              netvirt-maven-merge-{stream}
              neutron-maven-merge-{stream},
              openflowplugin-maven-merge-{stream},
              ovsdb-maven-merge-{stream},
              serviceutils-maven-merge-{stream},
      - sodium:
          branch: 'stable/sodium'
          dependencies: >
              aaa-merge-{stream},
              bgpcep-merge-{stream},
              coe-merge-{stream},
              controller-merge-{stream},
              daexim-merge-{stream},
              genius-merge-{stream},
              infrautils-merge-{stream},
              lispflowmapping-merge-{stream},
              netconf-merge-{stream},
              netvirt-merge-{stream}
              neutron-merge-{stream},
              openflowplugin-merge-{stream},
              ovsdb-merge-{stream},
              serviceutils-merge-{stream},
              sfc-merge-{stream}
      - neon:
          branch: 'stable/neon'
          dependencies: >
              aaa-merge-{stream},
              bgpcep-merge-{stream},
              coe-merge-{stream},
              controller-merge-{stream},
              daexim-merge-{stream},
              genius-merge-{stream},
              infrautils-merge-{stream},
              lispflowmapping-merge-{stream},
              netconf-merge-{stream},
              netvirt-merge-{stream}
              neutron-merge-{stream},
              openflowplugin-merge-{stream},
              ovsdb-merge-{stream},
              serviceutils-merge-{stream},
              sfc-merge-{stream}

- project:
    name: distribution-full
    jobs:
      # gerrit- is generic template, distribution- is project specific.
      - 'distribution-merge-{type}-{stream}'
      - 'distribution-verify-{type}-{stream}'
      - 'distribution-check-{type}-{stream}'

    project: integration/distribution
    project-name: distribution
    mvn-settings: integration-distribution-settings
    mvn-goals: 'clean install dependency:tree -DoutputFile=dependency_tree.txt'
    mvn-opts: '-Xmx1024m'
    email-upstream: '[int/dist]'
    type: full
    profile: '-Punmanaged'
    files: 'opendaylight/**'
    karaf-version: odl
    dist-pom: 'distribution/opendaylight/pom.xml'

    stream:
      - aluminium:
          branch: 'master'
          java-version: 'openjdk11'
          karaf-version: odl
          dependencies: >
              distribution-merge-managed-{stream},
      - magnesium:
          branch: 'stable/magnesium'
          java-version: 'openjdk11'
          karaf-version: odl
          dependencies: >
              distribution-merge-managed-{stream},
              detnet-merge-{stream}
      - sodium:
          branch: 'stable/sodium'
          karaf-version: odl
          dependencies: >
              distribution-merge-managed-{stream},
              transportpce-merge-{stream}
      - neon:
          branch: 'stable/neon'
          karaf-version: odl
          dependencies: >
              distribution-merge-managed-{stream},
              transportpce-merge-{stream}

- project:
    name: distribution-release
    jobs:
      - gerrit-maven-stage:
          sign-artifacts: true
      - gerrit-release-merge

    project: 'integration/distribution'
    project-name: 'distribution'
    mvn-goals: 'clean deploy -f opendaylight/pom.xml'
    mvn-settings: 'integration-distribution-settings'
    mvn-opts: '-Xmx1024m'
    email-upstream: '[int/dist]'

    # Used by the release job
    staging-profile-id: 2af042ed81d5e2

    stream:
      - aluminium:
          branch: 'master'
          java-version: 'openjdk11'
      - magnesium:
          branch: 'stable/magnesium'
          java-version: 'openjdk11'
      - sodium:
          branch: 'stable/sodium'
      - neon:
          branch: 'stable/neon'

- project:
    name: distribution-sonar
    jobs:
      - gerrit-maven-sonar

    project: integration/distribution
    project-name: distribution
    branch: master
    java-version: 'openjdk11'
    mvn-settings: integration-distribution-settings
    mvn-goals: clean install dependency:tree -DoutputFile=dependency_tree.txt
    mvn-opts: '-Xmx1024m'

- project:
    name: distribution-view
    views:
      - common-view
    view-name: distribution
    view-regex: '^(integration-)?distribution-.*'
