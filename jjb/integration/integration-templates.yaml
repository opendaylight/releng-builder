# Job templates in this file (please update with every new template):
#
# New (for Be release):
# {project}-csit-verify-1node-{functionality}
# {project}-csit-1node-{functionality}-{install}-{stream}
# {project}-csit-1node-periodic-{functionality}-{install}-{stream}
# {project}-csit-verify-3node-{functionality}
# {project}-csit-3node-{functionality}-{install}-{stream}
# {project}-csit-3node-periodic-{functionality}-{install}-{stream}
#
# Parameters:
#
# opendaylight-infra-parameters: main project integration/test ($PROJECT)
# jre: (openjdk7 or openjdk8) Java runtime environment to use when launching ODL
# integration-branch: distribution branch ($BRANCH)
# integration-controller-bundleurl: distribution URL ($BUNDLEURL)
# integration-controller-scope: only or all features ($CONTROLLERSCOPE)
# integration-controller-features: features under test ($CONTROLLER FEATURES)
# integration-test-options: robot options ($TESTOPTIONS)
# integration-stream-test-plan: stream specific robot test plan ($STREAMTESTPLAN)
# integration-test-plan: fallback robot test plan ($TESTPLAN)
# integration-patch-refspec: test branch ($PATCHREFSPEC)


# New templates

- job-template:
    name: '{project}-csit-verify-1node-{functionality}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: 'stable/boron'
        - integration-distribution-stream:
            stream: 'boron'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: 'only'
        - integration-controller-features:
            controller-features: '{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-boron.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-jdk-version:
            jdkversion: 'openjdk8'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$GERRIT_REFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - integration-trigger-patch-submitted:
            server: '{server-name}'
            project: 'integration/test'
            branch: 'master'
            files: 'csit/suites/{project}/**'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '1'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{tools_system_count}'
            vm_1_flavor: '{tools_system_flavor}'
            vm_1_image: '{tools_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-deploy-controller-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-1node-{functionality}-{install}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: '{scope}'
        - integration-controller-features:
            controller-features: '{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-{stream}.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - integration-csit-{install}:
            jobs: '{trigger-jobs}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '1'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{tools_system_count}'
            vm_1_flavor: '{tools_system_flavor}'
            vm_1_image: '{tools_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-deploy-controller-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - plot:
          - title: '{01-plot-title}'
            yaxis: '{01-plot-yaxis}'
            group: '{01-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-{functionality}-{install}-{stream}-{01-plot-data-file}-history.csv'
            series:
              - file: '{01-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{02-plot-title}'
            yaxis: '{02-plot-yaxis}'
            group: '{02-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-{functionality}-{install}-{stream}-{02-plot-data-file}-history.csv'
            series:
              - file: '{02-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: '{scope}'
        - integration-controller-features:
            controller-features: '{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-{stream}.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'
        - integration-jclouds-controller-mininet:
            controller-image: '{controller-image}'
            controller-vms: 1
            mininet-image: '{mininet-image}'
            mininet-vms: '{mininet-vms}'

    triggers:
        - timed: '{schedule}'

    builders:
        - integration-copy-ssh-keys
        - integration-cleanup-workspace
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-deploy-controller-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - plot:
          - title: '{01-plot-title}'
            yaxis: '{01-plot-yaxis}'
            group: '{01-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-periodic-1node-{functionality}-{install}-{stream}-{01-plot-data-file}-history.csv'
            series:
              - file: '{01-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{02-plot-title}'
            yaxis: '{02-plot-yaxis}'
            group: '{02-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-periodic-1node-{functionality}-{install}-{stream}-{02-plot-data-file}-history.csv'
            series:
              - file: '{02-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{03-plot-title}'
            yaxis: '{03-plot-yaxis}'
            group: '{03-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{03-plot-data-file}-03-history.csv'
            series:
              - file: '{03-plot-data-file}'
                inclusion-flag: '{03-inclusion-flag}'
                exclude: '{03-exclude-value}'
                format: csv
          - title: '{04-plot-title}'
            yaxis: '{04-plot-yaxis}'
            group: '{04-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{04-plot-data-file}-04-history.csv'
            series:
              - file: '{04-plot-data-file}'
                inclusion-flag: '{04-inclusion-flag}'
                exclude: '{04-exclude-value}'
                format: csv
          - title: '{05-plot-title}'
            yaxis: '{05-plot-yaxis}'
            group: '{05-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{05-plot-data-file}-05-history.csv'
            series:
              - file: '{05-plot-data-file}'
                inclusion-flag: '{05-inclusion-flag}'
                exclude: '{05-exclude-value}'
                format: csv
          - title: '{06-plot-title}'
            yaxis: '{06-plot-yaxis}'
            group: '{06-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{06-plot-data-file}-06-history.csv'
            series:
              - file: '{06-plot-data-file}'
                inclusion-flag: '{06-inclusion-flag}'
                exclude: '{06-exclude-value}'
                format: csv
          - title: '{07-plot-title}'
            yaxis: '{07-plot-yaxis}'
            group: '{07-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{07-plot-data-file}-07-history.csv'
            series:
              - file: '{07-plot-data-file}'
                inclusion-flag: '{07-inclusion-flag}'
                exclude: '{07-exclude-value}'
                format: csv
          - title: '{08-plot-title}'
            yaxis: '{08-plot-yaxis}'
            group: '{08-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{08-plot-data-file}-08-history.csv'
            series:
              - file: '{08-plot-data-file}'
                inclusion-flag: '{08-inclusion-flag}'
                exclude: '{08-exclude-value}'
                format: csv
          - title: '{09-plot-title}'
            yaxis: '{09-plot-yaxis}'
            group: '{09-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{09-plot-data-file}-09-history.csv'
            series:
              - file: '{09-plot-data-file}'
                inclusion-flag: '{09-inclusion-flag}'
                exclude: '{09-exclude-value}'
                format: csv
          - title: '{10-plot-title}'
            yaxis: '{10-plot-yaxis}'
            group: '{10-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-1node-periodic-{functionality}-{install}-{stream}-{10-plot-data-file}-10-history.csv'
            series:
              - file: '{10-plot-data-file}'
                inclusion-flag: '{10-inclusion-flag}'
                exclude: '{10-exclude-value}'
                format: csv
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-verify-3node-{functionality}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: 'stable/boron'
        - integration-distribution-stream:
            stream: 'boron'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: 'only'
        - integration-controller-features:
            controller-features: 'odl-jolokia,{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-boron.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-jdk-version:
            jdkversion: 'openjdk8'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$GERRIT_REFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - integration-trigger-patch-submitted:
            server: '{server-name}'
            project: 'integration/test'
            branch: 'master'
            files: 'csit/suites/{project}/**'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '3'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{tools_system_count}'
            vm_1_flavor: '{tools_system_flavor}'
            vm_1_image: '{tools_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-configure-clustering
        - integration-start-cluster-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-3node-{functionality}-{install}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: '{scope}'
        - integration-controller-features:
            controller-features: 'odl-jolokia,{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-{stream}.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - integration-csit-{install}:
            jobs: '{trigger-jobs}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '3'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{tools_system_count}'
            vm_1_flavor: '{tools_system_flavor}'
            vm_1_image: '{tools_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-configure-clustering
        - integration-start-cluster-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - plot:
          - title: '{01-plot-title}'
            yaxis: '{01-plot-yaxis}'
            group: '{01-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-{functionality}-{install}-{stream}-{01-plot-data-file}-history.csv'
            series:
              - file: '{01-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{02-plot-title}'
            yaxis: '{02-plot-yaxis}'
            group: '{02-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-{functionality}-{install}-{stream}-{02-plot-data-file}-history.csv'
            series:
              - file: '{02-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-3node-docker-{functionality}-{install}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: '{scope}'
        - integration-controller-features:
            controller-features: 'odl-jolokia,{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-{stream}.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - integration-csit-{install}:
            jobs: '{trigger-jobs}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '3'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{docker_system_count}'
            vm_1_flavor: '{docker_system_flavor}'
            vm_1_image: '{docker_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-configure-clustering
        - integration-start-cluster-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - plot:
          - title: '{01-plot-title}'
            yaxis: '{01-plot-yaxis}'
            group: '{01-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-{functionality}-{install}-{stream}-{01-plot-data-file}-history.csv'
            series:
              - file: '{01-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{02-plot-title}'
            yaxis: '{02-plot-yaxis}'
            group: '{02-plot-group}'
            num-builds: '5400'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-{functionality}-{install}-{stream}-{02-plot-data-file}-history.csv'
            series:
              - file: '{02-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-scope:
            controller-scope: '{scope}'
        - integration-controller-features:
            controller-features: 'odl-jolokia,{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-stream-test-plan:
            stream-test-plan: '{project}-{functionality}-{stream}.txt'
        - integration-test-plan:
            test-plan: '{project}-{functionality}.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '{schedule}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '3'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{tools_system_count}'
            vm_1_flavor: '{tools_system_flavor}'
            vm_1_image: '{tools_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-configure-clustering
        - integration-start-cluster-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - plot:
          - title: '{01-plot-title}'
            yaxis: '{01-plot-yaxis}'
            group: '{01-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{01-plot-data-file}-history.csv'
            series:
              - file: '{01-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{02-plot-title}'
            yaxis: '{02-plot-yaxis}'
            group: '{02-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{02-plot-data-file}-history.csv'
            series:
              - file: '{02-plot-data-file}'
                inclusion-flag: 'off'
                display-table: true
                format: csv
          - title: '{03-plot-title}'
            yaxis: '{03-plot-yaxis}'
            group: '{03-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{03-plot-data-file}-03-history.csv'
            series:
              - file: '{03-plot-data-file}'
                inclusion-flag: '{03-inclusion-flag}'
                exclude: '{03-exclude-value}'
                format: csv
          - title: '{04-plot-title}'
            yaxis: '{04-plot-yaxis}'
            group: '{04-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{04-plot-data-file}-04-history.csv'
            series:
              - file: '{04-plot-data-file}'
                inclusion-flag: '{04-inclusion-flag}'
                exclude: '{04-exclude-value}'
                format: csv
          - title: '{05-plot-title}'
            yaxis: '{05-plot-yaxis}'
            group: '{05-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{05-plot-data-file}-05-history.csv'
            series:
              - file: '{05-plot-data-file}'
                inclusion-flag: '{05-inclusion-flag}'
                exclude: '{05-exclude-value}'
                format: csv
          - title: '{06-plot-title}'
            yaxis: '{06-plot-yaxis}'
            group: '{06-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{06-plot-data-file}-06-history.csv'
            series:
              - file: '{06-plot-data-file}'
                inclusion-flag: '{06-inclusion-flag}'
                exclude: '{06-exclude-value}'
                format: csv
          - title: '{07-plot-title}'
            yaxis: '{07-plot-yaxis}'
            group: '{07-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{07-plot-data-file}-07-history.csv'
            series:
              - file: '{07-plot-data-file}'
                inclusion-flag: '{07-inclusion-flag}'
                exclude: '{07-exclude-value}'
                format: csv
          - title: '{08-plot-title}'
            yaxis: '{08-plot-yaxis}'
            group: '{08-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{08-plot-data-file}-08-history.csv'
            series:
              - file: '{08-plot-data-file}'
                inclusion-flag: '{08-inclusion-flag}'
                exclude: '{08-exclude-value}'
                format: csv
          - title: '{09-plot-title}'
            yaxis: '{09-plot-yaxis}'
            group: '{09-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{09-plot-data-file}-09-history.csv'
            series:
              - file: '{09-plot-data-file}'
                inclusion-flag: '{09-inclusion-flag}'
                exclude: '{09-exclude-value}'
                format: csv
          - title: '{10-plot-title}'
            yaxis: '{10-plot-yaxis}'
            group: '{10-plot-group}'
            num-builds: '180'
            keep-records: true
            style: line
            use-description: false
            csv-file-name: '{project}-csit-3node-periodic-{functionality}-{install}-{stream}-{10-plot-data-file}-10-history.csv'
            series:
              - file: '{10-plot-data-file}'
                inclusion-flag: '{10-inclusion-flag}'
                exclude: '{10-exclude-value}'
                format: csv
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-1node-openstack-{openstack}-{functionality}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g
    concurrent: true

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-features:
            controller-features: '{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-test-plan:
            test-plan: '{testplan}'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'
        - string:
            name: OPENSTACK_BRANCH
            default: '{openstack-branch}'
            description: 'Openstack version to use with devstack'
        - string:
            name: ODL_ML2_DRIVER_REPO
            default: '{odl-ml2-driver-repo}'
            description: 'URL to fetch networking-odl driver'
        - string:
            name: ODL_ML2_BRANCH
            default: '{odl-ml2-branch}'
            description: 'Version of networking-odl to checkout from the repo'
        - string:
            name: ODL_ML2_DRIVER_VERSION
            default: '{odl-ml2-driver-version}'
            description: 'Mode of networking-odl (v1 or v2)'
        - string:
            name: ODL_ENABLE_L3_FWD
            default: '{odl-enable-l3}'
            description: 'Enable L3 FWD in ODL for createing br-ex'
        - string:
            name: PUBLIC_BRIDGE
            default: '{public-bridge}'
            description: 'Specifies public bridge for provider and external networking'
        - string:
            name: ENABLE_OS_SERVICES
            default: '{enable-openstack-services}'
            description: 'comma seperated list of services to enable'
        - string:
            name: DISABLE_OS_SERVICES
            default: '{disable-openstack-services}'
            description: 'comma seperated list of services to enable'
        - string:
            name: TENANT_NETWORK_TYPE
            default: '{tenant-network-type}'
            description: 'Tenant Network Type supported by the implementation'
        - string:
            name: SECURITY_GROUP_MODE
            default: '{security-group-mode}'
            description: 'Security Group Mode to be used in netvirt aclservice config'
    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '{schedule}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '1'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{openstack_system_count}'
            vm_1_flavor: '{openstack_system_flavor}'
            vm_1_image: '{openstack_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-deploy-controller-run-test
        - integration-deploy-openstack-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot-tempest:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

- job-template:
    name: '{project}-csit-3node-openstack-{openstack}-{functionality}-{stream}'
    disabled: false

    project-type: freestyle
    node: centos7-robot-2c-2g
    concurrent: true

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: 'integration/test'
            branch: '{branch}'
            refspec: 'refs/heads/{branch}'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-stream:
            stream: '{stream}'
        - integration-bundleurl:
            bundleurl: '{bundleurl}'
        - integration-controller-features:
            controller-features: 'odl-jolokia,{install-features}'
        - integration-test-options:
            test-options: '{robot-options}'
        - integration-test-plan:
            test-plan: '{project}-3node-openstack.txt'
        - integration-patch-refspec:
            branch: 'master'
        - integration-jdk-version:
            jdkversion: '{jre}'
        - string:
            name: OPENSTACK_BRANCH
            default: '{openstack-branch}'
            description: 'Openstack version to use with devstack'
        - string:
            name: ODL_ML2_DRIVER_REPO
            default: '{odl-ml2-driver-repo}'
            description: 'URL to fetch networking-odl driver'
        - string:
            name: ODL_ML2_BRANCH
            default: '{odl-ml2-branch}'
            description: 'Version of networking-odl to checkout from the repo'
        - string:
            name: ODL_ML2_DRIVER_VERSION
            default: '{odl-ml2-driver-version}'
            description: 'Mode of networking-odl (v1 or v2)'
        - string:
            name: ODL_ENABLE_L3_FWD
            default: '{odl-enable-l3}'
            description: 'Enable L3 FWD in ODL for createing br-ex'
        - string:
            name: PUBLIC_BRIDGE
            default: '{public-bridge}'
            description: 'Specifies public bridge for provider and external networking'
        - string:
            name: ENABLE_HAPROXY_FOR_NEUTRON
            default: '{enable-haproxy}'
            description: 'Enable HAProxy for using neutron interface as HA'
        - string:
            name: ENABLE_OS_SERVICES
            default: '{enable-openstack-services}'
            description: 'comma seperated list of services to enable'
        - string:
            name: DISABLE_OS_SERVICES
            default: '{disable-openstack-services}'
            description: 'comma seperated list of services to enable'
        - string:
            name: TENANT_NETWORK_TYPE
            default: '{tenant-network-type}'
            description: 'Tenant Network Type supported by the implementation'
        - string:
            name: SECURITY_GROUP_MODE
            default: '{security-group-mode}'
            description: 'Security Group Mode to be used in netvirt aclservice config'

    scm:
        - integration-gerrit-scm:
            basedir: 'test'
            refspec: '$PATCHREFSPEC'
            branch: 'master'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '{schedule}'

    builders:
        - integration-infra-stack:
            stack-template: '{stack-template}'
            vm_0_count: '3'
            vm_0_flavor: '{odl_system_flavor}'
            vm_0_image: '{odl_system_image}'
            vm_1_count: '{openstack_system_count}'
            vm_1_flavor: '{openstack_system_flavor}'
            vm_1_image: '{openstack_system_image}'
        - integration-install-robotframework
        - inject:
            properties-file: 'env.properties'
        - integration-get-slave-addresses
        - inject:
            properties-file: 'slave_addresses.txt'
        - integration-get-bundle-vars
        - inject:
            properties-file: 'bundle_vars.txt'
        - integration-configure-clustering
        - integration-start-cluster-run-test
        - integration-deploy-openstack-run-test
        - integration-cleanup-tmp

    publishers:
        - integration-robot-tempest:
            unstable-if: 0.0
            pass-if: 100.0
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
        - integration-csit-archive-build
        - opendaylight-infra-shiplogs:
            maven-version: 'mvn33'

# Template: {project}-patch-test-{stream}
# Goal: Build a patch and run project specific system test on a distribution containing the change
# Operation: This job template builds a patch, creates a distribution containing the patch, and
# triggers the project system test defined in {csit-list} when gerrit receives test-{project} keyword

- job-template:
    name: '{project}-patch-test-{feature}-{stream}'

    project-type: maven
    node: centos7-java-builder-2c-8g
    concurrent: true
    jdk: '{jdk}'

    properties:
        - opendaylight-infra-properties:
            build-days-to-keep: '{build-days-to-keep}'

    parameters:
        - opendaylight-infra-parameters:
            project: '{project}'
            branch: '{branch}'
            refspec: '$GERRIT_REFSPEC'
            artifacts: '{archive-artifacts}'
        - integration-branch:
            branch: '{branch}'
        - integration-distribution-git-url:
            git-url: '{git-url}'
        - string:
            name: feature
            default: 'all'
            description: 'Specific feature test for patch'

    scm:
        - integration-gerrit-scm:
            basedir: '{project}'
            refspec: '$GERRIT_REFSPEC'
            branch: '{branch}'
        - integration-distribution-scm:
            branch: '{branch}'

    wrappers:
        - opendaylight-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit:
            server-name: '{server-name}'
            trigger-on:
                - comment-added-contains-event:
                    comment-contains-value: 'test-{project}-all'
                - comment-added-contains-event:
                    comment-contains-value: 'test-{project}-{feature}'
            projects:
              - project-compare-type: 'ANT'
                project-pattern: '{project}'
                branches:
                  - branch-compare-type: 'ANT'
                    branch-pattern: '**/{branch}'
            skip-vote:
                successful: true
                failed: true
                unstable: true
                notbuilt: true

    prebuilders:
        - integration-rebase-gerrit-patch
        - integration-get-bundle-url
        - inject:
            properties-file: 'bundle.txt'
        - wipe-org-opendaylight-repo
        - provide-maven-settings:
            global-settings-file: 'odl-global-settings'
            settings-file: 'integration-settings'
        - maven-target:
            maven-version: 'mvn33'
            pom: '{project}/pom.xml'
            goals: 'clean install dependency:tree -V -B -Djenkins -DskipTests -Dcheckstyle.skip=true -Dmaven.javadoc.skip=true -Dmaven.site.skip=true -DgenerateReports=false -Dmaven.repo.local=/tmp/r -Dorg.ops4j.pax.url.mvn.localRepository=/tmp/r -Dstream={stream}'
            java-opts:
                - '-Xmx4096m -XX:MaxPermSize=1024m -Dmaven.compile.fork=true'
            settings: 'integration-settings'
            settings-type: cfp
            global-settings: 'odl-global-settings'
            global-settings-type: cfp

    maven:
        maven-name: 'mvn33'
        root-pom: 'distribution/pom.xml'
        goals: 'clean install dependency:tree -V -B -Djenkins -Dmaven.repo.local=/tmp/r -Dorg.ops4j.pax.url.mvn.localRepository=/tmp/r'
        maven-opts: '-Xmx1024m -XX:MaxPermSize=256m -Dmaven.compile.fork=true'
        settings: 'integration-settings'
        settings-type: cfp
        global-settings: 'odl-global-settings'
        global-settings-type: cfp
        ignore-upstream-changes: true
        post-step-run-condition: 'SUCCESS'

    postbuilders:
        - trigger-builds:
            - project: '{csit-list}'
              block: true
              predefined-parameters:
                  BUNDLEURL=$BUNDLEURL

    publishers:
        - email-notification:
            email-recipients: '{email-recipients}'
            email-prefix: '[{project}]'
