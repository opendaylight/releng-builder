#!/usr/bin/expect
# This script starts the karaf shell and sends the password for SSH auth.
# Further tests in karaf shell can be done here

# Default password
set password "karaf"
# Default prompt
set prompt "opendaylight-user@root>"

# SSH into Karaf shell
spawn ssh -p 8101 -o StrictHostKeyChecking=no karaf@127.0.0.1
expect "Password: "
send "$password\r"

# Verify expected features
expect "$prompt"
send "feature:list | grep odl-netvirt-openstack\r"
# TODO Should we be checking output?
expect "$prompt"

# Install feature
expect "$prompt"
send "feature:install odl-netvirt-openstack\r"
expect "$prompt"

# Verify installed feature is actually installed
expect "$prompt"
send "feature:list | grep odl-netvirt-openstack | grep \" x \"\r"
# TODO Should we be checking output?
expect "$prompt"

# TODO Add further tests here
