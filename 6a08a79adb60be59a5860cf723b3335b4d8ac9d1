{
  "comments": [
    {
      "key": {
        "uuid": "da2a55be_23f3e674",
        "filename": "jjb/packaging/include-raw-build-rpm-snap.sh",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 2759
      },
      "writtenOn": "2017-06-27T15:55:12Z",
      "side": 0,
      "message": "So the reason this was done is it works around long job names that overflow the Linux kernel max commandline length due to extremely long shebangs which we\u0027ve run into for a few jobs.\n\nIf we don\u0027t want to do this then the alternative we\u0027ve started recommending projects do is to build their virutalenvs in /tmp/v for example:\n\nhttps://gerrit.linuxfoundation.org/infra/gitweb?p\u003dreleng/global-jjb.git;a\u003dblob;f\u003dshell/tox-install.sh;h\u003d2cffbd50cfda7440f97fc03c210800866d329c7b;hb\u003dHEAD\n\nIf this is not done then jobs that have too long a name will fail with a confusing message \"bad intepreter\".",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 15,
        "endChar": 11
      },
      "revId": "6a08a79adb60be59a5860cf723b3335b4d8ac9d1",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da2a55be_7e6e15cb",
        "filename": "jjb/packaging/include-raw-build-rpm-snap.sh",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1723
      },
      "writtenOn": "2017-06-27T17:00:23Z",
      "side": 0,
      "message": "I know about the long names problem, but I don\u0027t think this dir structure was related to it. It was just advice I gave to Akshita about where to put her deb/ dir. He also has sandbox runs that use this and don\u0027t fail. https://jenkins.opendaylight.org/sandbox/job/packaging-build-rpm-master/4/\nhttps://jenkins.opendaylight.org/sandbox/job/packaging-build-rpm-snap-master/4/",
      "parentUuid": "da2a55be_23f3e674",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 15,
        "endChar": 11
      },
      "revId": "6a08a79adb60be59a5860cf723b3335b4d8ac9d1",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da2a55be_3e82dd52",
        "filename": "jjb/packaging/include-raw-build-rpm-snap.sh",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 2759
      },
      "writtenOn": "2017-06-27T17:15:26Z",
      "side": 0,
      "message": "Yes it\u0027s less of a problem here because packaging is the only project that uses these scripts and if it does fail you will know immediately. Just a suggestion to improve things. Personally I think putting stuff in /tmp/v is good practice moving forward regardless so that people copying existing scripts won\u0027t copy something that might break for them.",
      "parentUuid": "da2a55be_7e6e15cb",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 15,
        "endChar": 11
      },
      "revId": "6a08a79adb60be59a5860cf723b3335b4d8ac9d1",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da2a55be_57ee8f8c",
        "filename": "jjb/packaging/include-raw-build-rpm-snap.sh",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 1723
      },
      "writtenOn": "2017-06-29T14:07:38Z",
      "side": 0,
      "message": "Sorry for being slow, but I don\u0027t actually understand what the ask is here. Somehow using a venv to magic things into /tmp/v so we have short path names?",
      "parentUuid": "da2a55be_3e82dd52",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 15,
        "endChar": 11
      },
      "revId": "6a08a79adb60be59a5860cf723b3335b4d8ac9d1",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da2a55be_1a171bef",
        "filename": "jjb/packaging/include-raw-build-rpm-snap.sh",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 2759
      },
      "writtenOn": "2017-06-29T17:04:06Z",
      "side": 0,
      "message": "Just a recommendation. Feel free to ignore if you don\u0027t want to change it but here\u0027s an explanation of why.\n\nSo when you install things into a virtualenv it set\u0027s that project\u0027s entry script\u0027s shebang line to be the full path to that project. For example here\u0027s what the shebang line looks like for JJB that\u0027s installed on my system:\n\n #!/home/zxiiro/.virtualenvs/jjb/bin/python3\n\nSo for a Jenkins job who\u0027s path is usually /w/\u003cjob-name\u003e if the job name is very long the shebang line will be very long.\n\nThe way commands are parsed inside virtualenvs is it uses full paths for all parameters so for example if we call JJB the CLI command that get\u0027s called will look like this:\n\n /home/zxiiro/.virtualenvs/jjb/bin/python3 /home/zxiiro/.virtualenvs/jjb/bin/jenkins-jobs ...\n\nThe Linux kernel itself has a limit on how long a single commandline can be called. So we\u0027ve hit issues that were hard to troubleshoot before where jobs that had long names caused this CLI to be over the Linux kernel\u0027s allowed length causing the build to fail with \"bad interpreter\".\n\nThe recommendation now is to install virtualenvs in /tmp/v/rpm_build for example just in case so that we don\u0027t get hit by this issue in case for some reason packaging ever has a job that has too long a job name.",
      "parentUuid": "da2a55be_57ee8f8c",
      "range": {
        "startLine": 15,
        "startChar": 0,
        "endLine": 15,
        "endChar": 11
      },
      "revId": "6a08a79adb60be59a5860cf723b3335b4d8ac9d1",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}